<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Sane usage of Custom Elements - Lucas Mazza</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">



  

<link href="/css/index.min.6e80c00c6ea57289fabce8d4412c05518d5b38fe59b85286f2e209f0773dc11e.css" rel="stylesheet" />
      <meta name="description" content="An example on moving from jQuery plugins into Web Components, minus the hype"/>
      <meta property="og:title" content="Sane usage of Custom Elements"/>
      <meta property="og:type" content="website"/>
      <meta property="og:url" content="https://lucasmazza.website/posts/2015-09-22-custom-elements/"/>
      
      <meta property="og:description" content="An example on moving from jQuery plugins into Web Components, minus the hype"/>

      <meta name="twitter:card" content="summary"/>
      <meta name="twitter:site" content="@lucasmazza"/>
      <meta name="twitter:creator" content="@lucasmazza"/>

      
  </head>
  
    <body>
  

    
  <div class="py-4 border-b border-slate-300 print:hidden">
  <div class="relative flex mx-auto lg:w-4/5 px-4 lg:p-0">
    <h1 class="flex mr-auto items-center">
      
      <a href="https://lucasmazza.website/" class="font-extrabold text-2xl text-green-700 whitespace-nowrap">Lucas Mazza</a>
    </h1>

    <div class="lg:hidden">
			<button id="menu-action" class="navbar-burger flex items-center text-green-700 p-3">
				<svg class="block h-8 w-8 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
					<title>Mobile menu</title>
					<path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path>
				</svg>
			</button>
		</div>
    <ul id="menu-target" class="hidden absolute top-full left-0 w-screen divide-y border-y bg-white lg:border-none lg:divide-none lg:static lg:flex lg:mx-auto lg:items-center lg:w-auto lg:space-x-6 lg:gap-3">
      
      
        <li class="p-4 text-xl lg:p-0 lg:text-base">
          <a href="https://lucasmazza.website/about/" class="hover:underline hover:text-green-900 ">About me</a>
        </li>
      
        <li class="p-4 text-xl lg:p-0 lg:text-base">
          <a href="https://lucasmazza.website/posts/" class="hover:underline hover:text-green-900 ">Posts</a>
        </li>
      
        <li class="p-4 text-xl lg:p-0 lg:text-base">
          <a href="https://lucasmazza.website/talks/" class="hover:underline hover:text-green-900 ">Presentations</a>
        </li>
      
        <li class="p-4 text-xl lg:p-0 lg:text-base">
          <a href="https://lucasmazza.website/htmlcss-exemplos" class="hover:underline hover:text-green-900 ">Livro HTML5 e CSS 3 →</a>
        </li>
      
        <li class="p-4 text-xl lg:p-0 lg:text-base">
          <a href="https://lucasmazza.notion.site/lucasmazza/Receitas-79a5a48a2350465dad3c57ba866f95d4" class="hover:underline hover:text-green-900 ">Receitas →</a>
        </li>
      
    </ul>
  </div>
</div>

  

  

<div class="mx-auto lg:w-7/12 px-4 mt-4 lg:mt-8 lg:p-0">
    
      <div class="mb-8 lg:flex items-center">
        
          <h1 class="font-extrabold text-4xl">Sane usage of Custom Elements</h1>
        

        
          <span class="inline-flex items-center text-sm mr-2 lg:mr-4 whitespace-nowrap ml-auto text-green-900">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
            </svg>
            Published on Sep 22, 2015
          </span>
        
      </div>
    

    <article class="content-body pb-8">
      
      <p>Web Components have been an controversial subject that surfaced in the Front end
world over the last years that I&rsquo;m still pretty skeptical about its usage on
existing and greenfield projects due the lack of good examples on how they
can be rolled out to production, but I believe there is a way to get started with them
without buying in all the hype.</p>
<p>The whole <a href="https://github.com/w3c/webcomponents">Web Components spec</a> holds four
different standards, but the <a href="http://w3c.github.io/webcomponents/spec/custom/">Custom Elements</a>
has some interesting features that can be useful to a lot of common tasks
from regular projects.</p>
<h2 id="the-life-of-a-javascript-plugin">The life of a JavaScript plugin</h2>
<p>I&rsquo;m currently using <code>data-*</code> attributes to annotate DOM elements that should
receive event handlers through <code>delegate</code> binds or be accessed directly
to add the behavior our JavaScript wants when we can&rsquo;t simply
delegate the event handlers through the document element.</p>
<p>Let&rsquo;s say we want to toggle the <code>disabled</code> attribute of <code>button</code> elements based
on the validation status of inputs placed inside the same <code>form</code> as the <code>button</code>
element.</p>
<p>A trivial implementation could be as simple as the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">bindDisabledButton</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">$</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;[data-disabled-button]&#39;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">each</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">button</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">$</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">form</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">button</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">parents</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;form&#39;</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">input</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">form</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">find</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;input:not(:hidden), select&#39;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">function</span> <span style="color:#000">updateButton</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">button</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">prop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;disabled&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">get</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">every</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">input</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000">input</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">checkValidity</span><span style="color:#000;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">on</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;keyup change&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">updateButton</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">updateButton</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">$</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bindDisabledButton</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p><em>We could <code>delegate</code> a <code>change</code> event on all inputs with validation and traverse
the DOM to grab their parent <code>form</code>, sibling inputs and <code>button</code>, but let&rsquo;s assume
the given code as the first implementation of this for this post.</em></p>
<p>The code would Probably Work™, and could be refactored to use different abstractions,
be executed only when there are elements in the page that haven&rsquo;t been selected
before and whatnot, but the most annoying part about this kind of implementation
(which is similar to 67.45% of JavaScript libraries and jQuery plugins we find
in the interwebs) is the fact that we manually initialize these plugins and components
by ourselves, and we have been doing this for a long time without worrying too
much about this.</p>
<p>The manual initialization isn&rsquo;t an issue with plain HTML that is fetched and
rendered in the browser, but it can become a huge pain in the ass when we sprinkle
more and more JavaScript on it and do things like Turbolinks/Pjax transitions or
plain DOM updates through XHR requests or client side logic: since we are responsible
for initialize this element, we must remember this every time the DOM changes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#000">$</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">document</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">on</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;ready page:load pjax:complete omg:wtf:bbq&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">bindDisabledButton</span><span style="color:#000;font-weight:bold">);</span>
</span></span></code></pre></div><p>This can easily escalate into more code to manually handle the life and death of
our enhanced elements - we need to care about when they need to be created in
our application and sometimes even when they need to be removed, as we might need to
cleanup event handlers or related elements that aren&rsquo;t properly isolated with the
node that will be removed from the page.</p>
<h2 id="if-you-want-custom-elements-then-you-should-probably-try-writing-custom-elements">If you want custom elements, then you should probably try writing Custom Elements.</h2>
<p>The first thing that got my attention when going through the Custom Elements spec was
the <a href="http://w3c.github.io/webcomponents/spec/custom/#types-of-callbacks">lifecycle callbacks</a>
that are available for developers to implement on their elements: we know when
the element is added or removed from the DOM and when its attributes are changed
by outside collaborators, and those callbacks can be extremely handy for pushing
all this lifecycle logic that can leak through our applications into self contained
elements.</p>
<p>For instance, this is how the same <code>[data-disabled-button]</code> plugin can be
re-implemented as a Custom Element:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// app/assets/javascripts/elements/disabled-button.es6
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">slice</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">Array</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">prototype</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">slice</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Public: Custom `button` element that is enabled and disabled based on the
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// validity state of the inputs inside the same &#39;form&#39; element as the button.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Example
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//  &lt;form&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//    &lt;input name=&#39;name&#39; required /&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//    &lt;button is=&#39;disabled-button&#39;&gt;Click me after you fill in the input&lt;/button&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">//  &lt;/form&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">DisabledButton</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">attachedCallback</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_form</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_findForm</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_updateCallback</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_update</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">bind</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_form</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">addEventListener</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;keyup&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_updateCallback</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">false</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_form</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">addEventListener</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;change&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_updateCallback</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">false</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_updateCallback</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">detachedCallback</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_form</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">removeEventListener</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;keyup&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_updateCallback</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_form</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">removeEventListener</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;change&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_updateCallback</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">_update</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">inputs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_findInputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_form</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">every</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">input</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000">input</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">checkValidity</span><span style="color:#000;font-weight:bold">()))</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">removeAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;disabled&#39;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">setAttribute</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;disabled&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">_findInputs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">form</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">inputs</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">slice</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">call</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">form</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">querySelectorAll</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;input, select&#39;</span><span style="color:#000;font-weight:bold">),</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">inputs</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">input</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000">input</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">type</span> <span style="color:#ce5c00;font-weight:bold">!==</span> <span style="color:#4e9a06">&#39;hidden&#39;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">_findForm</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">element</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">element</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">nodeName</span> <span style="color:#ce5c00;font-weight:bold">===</span> <span style="color:#4e9a06">&#39;FORM&#39;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">element</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">_findForm</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">element</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">parentElement</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">};</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">DisabledButtonPrototype</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">Object</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">create</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">HTMLButtonElement</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">prototype</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">Object</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">keys</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">DisabledButton</span><span style="color:#000;font-weight:bold">).</span><span style="color:#000">forEach</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prop</span> <span style="color:#000;font-weight:bold">=&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">DisabledButtonPrototype</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">prop</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">DisabledButton</span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">prop</span><span style="color:#000;font-weight:bold">];</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">window</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">DisabledButtonElement</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87">document</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">registerElement</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;disabled-button&#39;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">prototype</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">DisabledButtonPrototype</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#4e9a06">&#39;extends&#39;</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;button&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">});</span>
</span></span></code></pre></div><p>Now, every time the browser adds a <code>disabled-button</code> element or a <code>button</code> with
<code>is='disabled-button'</code>, it will be responsible for adding
the necessary behavior to our button to be disabled when its parent form isn&rsquo;t
valid or not, regardless of how the element got there in the first place - a
from an page transition done through ajax or a script executed in the browser&rsquo;s
console that appended an element to the page.</p>
<p>In order to just enhance existing elements rather than go full JSF on my markup,
I&rsquo;m sticking with <a href="http://w3c.github.io/webcomponents/spec/custom/#type-extension-example">type extensions</a> -
the <code>is=&quot;disabled-button&quot;</code> instead of having a <code>&lt;disabled-button&gt;&lt;/disabled-button&gt;</code> tag
in the markup - rather than implementing custom tags, avoiding <code>template</code> elements,
Shadow DOM and HTML imports in order to keep my markup as simple as it can be with
the benefits of better abstractions on the JavaScript code.</p>
<p>In the end, the required markup change is to replace any <code>data-*</code> attribute that
is used to hook the JavaScript code with a matching <code>is=&quot;component-name&quot;</code> for
an equivalent Custom Element implementation.</p>
<h2 id="similar-use-cases">Similar use cases</h2>
<p>Besides our exceptional <code>button</code> that its a bit more clever than other plain buttons,
there are several patterns that I can think of that can benefit from a Custom Element
implementation that I&rsquo;ve encountered in projects in the past and might experiment
by implementing them as type extensions in the future:</p>
<ul>
<li>alert messages rendered using Rails <code>flash.notice</code> and <code>flash.alert</code> that should
be removed from the interface after a short delay: a <code>setTimeout</code> can be enqueued
right after the element is attached for it to be removed.</li>
<li>Bootstrap <a href="http://getbootstrap.com/javascript/#tooltips">Tooltips</a> or <a href="http://getbootstrap.com/javascript/#popovers">Popovers</a>,
plugins that need to initialized manually, and you can have a shortcut for that
by hooking it through a Custom Element. Same thing could be done to <a href="https://harvesthq.github.io/chosen/">Chosen</a>
or any other <code>select</code> replacement plugin you might need to use.</li>
<li>Elements that should change based on events or the state of other related elements,
like our <code>disabled-button</code> example.</li>
<li>Probably any other widget you might have to use.</li>
</ul>
<p>Some common use cases that already have been implemented, GitHub&rsquo;s <a href="https://github.com/github/time-elements"><code>time-elements</code></a>
and <a href="https://github.com/github/include-fragment-element"><code>include-fragment-element</code></a> are
the first ones that come to mind.</p>

    </article>
  </div>

  <div class="py-8 flex mx-auto lg:w-7/12 border-t border-slate-300 justify-center gap-4 print:hidden">
  <p class="font-xs text-green-900">
    Copyright &copy; 2022 Lucas Mazza
  </p>
</div>


    
  <script defer src="/menu.08b9a569e417578ad09b03e0b4469fe181e7a74b3614ce1f7e2a7b98e7e99f29.js"></script>
  </body>
</html>