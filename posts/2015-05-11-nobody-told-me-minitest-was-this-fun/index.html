<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Nobody told me Minitest was this fun - Lucas Mazza</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">    
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">



  

<link href="/css/index.min.482157b608992a35db84e964ec0125074bb98514a7def59b7e41801e0466964a.css" rel="stylesheet" />
      <meta name="description" content="Where the author kinda regrets getting too attached to RSpec"/>
      <meta property="og:title" content="Nobody told me Minitest was this fun"/>
      <meta property="og:type" content="website"/>
      <meta property="og:url" content="https://lucasmazza.website/posts/2015-05-11-nobody-told-me-minitest-was-this-fun/"/>
      
      <meta property="og:description" content="Where the author kinda regrets getting too attached to RSpec"/>

      <meta name="twitter:card" content="summary"/>
      <meta name="twitter:site" content="@lucasmazza"/>
      <meta name="twitter:creator" content="@lucasmazza"/>

      
  </head>
  
    <body>
  

    
  <div class="py-4 border-b border-slate-300 print:hidden">
  <div class="relative flex mx-auto lg:w-4/5 px-4 lg:p-0">
    <h1 class="flex mr-auto items-center">
      <img src="/images/lucas.jpg" alt="Lucas's face" class="mr-1 w-12 h-12 lg:w-8 lg:h-8 rounded-md">
      <a href="https://lucasmazza.website/" class="font-extrabold text-2xl text-green-700 whitespace-nowrap">Lucas Mazza</a>
    </h1>

    <div class="lg:hidden">
			<button id="menu-action" class="navbar-burger flex items-center text-green-700 p-3">
				<svg class="block h-8 w-8 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
					<title>Mobile menu</title>
					<path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"></path>
				</svg>
			</button>
		</div>
    <ul id="menu-target" class="hidden absolute top-full left-0 w-screen divide-y border-y bg-white lg:border-none lg:divide-none lg:static lg:flex lg:mx-auto lg:items-center lg:w-auto lg:space-x-6 lg:gap-3">
      
      
        <li class="p-4 text-xl lg:p-0 lg:text-base">
          <a href="https://lucasmazza.website/about/" class="hover:underline hover:text-green-900 ">About me</a>
        </li>
      
        <li class="p-4 text-xl lg:p-0 lg:text-base">
          <a href="https://lucasmazza.website/posts/" class="hover:underline hover:text-green-900 ">Posts</a>
        </li>
      
        <li class="p-4 text-xl lg:p-0 lg:text-base">
          <a href="https://lucasmazza.website/talks/" class="hover:underline hover:text-green-900 ">Presentations</a>
        </li>
      
        <li class="p-4 text-xl lg:p-0 lg:text-base">
          <a href="https://lucasmazza.website/htmlcss-exemplos" class="hover:underline hover:text-green-900 ">Livro HTML5 e CSS 3 →</a>
        </li>
      
        <li class="p-4 text-xl lg:p-0 lg:text-base">
          <a href="https://lucasmazza.notion.site/lucasmazza/Receitas-79a5a48a2350465dad3c57ba866f95d4" class="hover:underline hover:text-green-900 ">Receitas →</a>
        </li>
      
    </ul>
  </div>
</div>

  

  <div class="mx-auto lg:w-7/12 px-4 mt-4 lg:mt-8 lg:p-0">
    <div class="mb-8 lg:flex items-center">
      
        <h1 class="font-extrabold text-4xl">Nobody told me Minitest was this fun</h1>
      

      
        <span class="inline-flex items-center text-sm mr-2 lg:mr-4 whitespace-nowrap ml-auto text-green-900">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
          </svg>
          Published on May 11, 2015
        </span>
      
    </div>
    <article class="content-body pb-8">
      <p>Ever since I started working with Ruby I have been using RSpec to test my apps and gems without giving minitest much thought. Recently I started a new non-Rails project and decided to give Minitest a try just for the fun of it. Migrating from one tool to another was refreshingly fun due to the fact that that Minitest and RSpec aren&rsquo;t so different from each other - they both have the basic features that we need in a testing library to get things running, and if you are used to testing your code moving from one to the other might not be so scary as you might expect.</p>
<h2 id="translating-testing-idioms">Translating testing idioms</h2>
<p>One of the first things that I looked into was how some of common RSpec idioms should be implemented when using Minitest.</p>
<p>The classic ones are fairly simple: the <code>before</code> and <code>after</code> lifecycle hooks should be equivalent as implementing the <code>setup</code> and <code>teardown</code> methods in your test class, and you have control over the inheritance chain by selecting when/where to call <code>super</code>. <code>let</code> and <code>subject</code> can be achieved with methods that use memoization to cache their values.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># A classic RSpec subject/before usage.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">&#39;spec_helper&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">describe</span> <span style="color:#000">Post</span> <span style="color:#204a87;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">subject</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">:post</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">Post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">new</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">before</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish!</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># The equivalent with Minitest &amp; Ruby.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">&#39;test_helper&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">PostTest</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">Minitest</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">post</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@post</span> <span style="color:#ce5c00;font-weight:bold">||=</span> <span style="color:#000">Post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">new</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">setup</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish!</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span></code></pre></div><p>RSpec shared examples, where you can reuse a set of examples across your test suite, can be replicated by simply writing your tests in modules and depend on accessor methods to inject any objects your tests might depend on</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># What used to be a shared_examples &#39;Serialization&#39; can be a module...</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">module</span> <span style="color:#000">SerializationTests</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">serializer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">raise</span> <span style="color:#000">NotImplementedError</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># And your test cases can include that module to copy the tests</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">JSONSerializationTest</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">Minitest</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">include</span> <span style="color:#000">SerializationTests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">serializer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">JSON</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MarshalSerializationTest</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">Minitest</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">include</span> <span style="color:#000">SerializationTests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">serializer</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Marshal</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span></code></pre></div><p>Mocks and stubs, which are incredibly flexible when using RSpec, are available in Minitest without any third party gem:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">PostTest</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">Minitest</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_notifies_on_publish</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">notifier</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Minitest</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Mock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">new</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">notifier</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">expect</span> <span style="color:#4e9a06">:notify!</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">notifier</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">notifier</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">notifier</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">verify</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_does_not_notifies_on_republish</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">notifier</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Minitest</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Mock</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">new</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">stub</span> <span style="color:#4e9a06">:published?</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">true</span> <span style="color:#204a87;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">notifier</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">notifier</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">notifier</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">verify</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span></code></pre></div><p>If you want a different or more fluent API, you can use something like <a href="https://github.com/freerange/mocha"><code>mocha</code></a> to improve your mocks, or even bring RSpec API into the mix - with some manual setup you can pick the <a href="https://github.com/rspec/rspec-mocks"><code>rspec-mocks</code></a> gem and define your mocks and stubs just like when using the complete RSpec tooling:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">&#39;rspec/mocks&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">PostTest</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">Minitest</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">include</span> <span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">RSpec</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Mocks</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ExampleMethods</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">before_setup</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">RSpec</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Mocks</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">setup</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">after_teardown</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">RSpec</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Mocks</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">verify</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">ensure</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">RSpec</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Mocks</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">teardown</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_notifies_on_publish</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">notifier</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">double</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;A notifier&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">expect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">notifier</span><span style="color:#000;font-weight:bold">)</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">to</span> <span style="color:#000">receive</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">:notify!</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">publish!</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">notifier</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">notifier</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span></code></pre></div><h2 id="know-your-assertions">Know your assertions</h2>
<p>One of my favorite parts of RSpec is how expressive the assertions can be - from the Ruby code that we have to write to the errors that the test runner will emit when something is broken. One might think that we can have something similar when working with Minitest, but that is not exactly true.</p>
<p>Let&rsquo;s say we want to test a method like <code>Post#active?</code>. Using a dynamic matcher from RSpec like <code>expect(post).to be_active</code> will produce a very straightforward message when that assertion fails: <code>expected #&lt;Post: …&gt;.active? to return false, got true</code>.</p>
<p>With Minitest, we might be tempted to write an assertion like <code>assert !post.active?</code>, but then the failure message wouldn&rsquo;t be much useful for us: <code>Failed assertion, no message given</code>. But fear not, because for something like this we have the <code>assert_predicate</code> and <code>refute_predicate</code> assertions, and they can produce very straightforward failure messages like <code>Expected #&lt;Post:…&gt; to not be active?.</code>, which clearly explains what went wrong with our tests.</p>
<p>Besides the predicate assertions, we have a few other assertion methods that can useful instead of playing with the plain <code>assert</code> method: <code>assert_includes</code>, <code>assert_same</code>, <code>assert_operator</code> and so on - and every one of those has a <code>refute_</code> counterpart for negative assertions.</p>
<p>It&rsquo;s always a matter of checking the documentation - The <a href="http://docs.seattlerb.org/minitest/Minitest/Assertions.html"><code>Minitest::Assertions</code> module</a> explains all the default assertions that you use with Minitest.</p>
<p>And in the case where you want to write a new assertion, you can always mimic how the built-in assertions are written to write your own:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">module</span> <span style="color:#000">ActiveModelAssertions</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">assert_valid</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">model</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">msg</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">nil</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">msg</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">message</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">msg</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">&#34;Expected </span><span style="color:#4e9a06">#{</span><span style="color:#000">model</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06"> to be valid, but got errors: </span><span style="color:#4e9a06">#{</span><span style="color:#000">errors</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">.&#34;</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">valid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">model</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">valid?</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">errors</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">model</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">errors</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">full_messages</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">join</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;, &#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">assert</span> <span style="color:#000">valid</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">msg</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">PostTest</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">Minitest</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Test</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">include</span> <span style="color:#000">ActiveModelAssertions</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">test_post_validations</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">post</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">new</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">title</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#39;The Post&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">assert_valid</span> <span style="color:#000">post</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span></code></pre></div><h2 id="active-support-goodies">Active Support goodies</h2>
<p>If you want some extra sugar in your tests, you can bring some of extensions that Active Support has for Minitest that are available when working with Rails - a more declarative API, some extra assertions, time traveling and anything else that Rails might bring to the table.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">&#39;active_support&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">&#39;active_support/test_case&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">&#39;minitest/autorun&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">ActiveSupport</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">test_order</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">:random</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">PostTest</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">ActiveSupport</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">TestCase</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic"># setup&#39; and teardown&#39; can be blocks,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic"># like RSpec before&#39; and after&#39;.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">setup</span> <span style="color:#204a87;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@post</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">new</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic"># &#39;test&#39; is a declarative way to define</span>
</span></span><span style="display:flex;"><span>  <span style="color:#8f5902;font-style:italic"># test methods.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87">test</span> <span style="color:#4e9a06">&#39;deactivating a post&#39;</span> <span style="color:#204a87;font-weight:bold">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">@post</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">deactivate!</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">refute_predicate</span> <span style="color:#000">@post</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">:active?</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">end</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">end</span>
</span></span></code></pre></div><h2 id="tweaking-the-toolchain">Tweaking the toolchain</h2>
<p>Minitest simplicity might not be so great when it comes to the default spec runner and reporter, which lack some of my favorite parts of RSpec - the verbose and colored output, the handful of command line flags or the report on failures that get the command to run a single failure test. But on the good side, even though Minitest does not ship with some of those features by default, there are a great number of gems that can help our test suite to be more verbose and friendly whenever we need to fix a failing test.</p>
<p>For instance, with the <a href="https://rubygems.org/gems/minitest-reporters">minitest-reporters</a> gem you can bring some color to your tests output or make it compatible with RubyMine and TeamCity. You can use reporters that are compatible with JUnit or RubyMine if that&rsquo;s your thing. You can use <a href="https://rubygems.org/gems/minitest-fail-fast">minitest-fail-fast</a> to bring the <code>--fail-fast</code> flag from RSpec and exit your test suite as soon as a test fails. Or you can track down object allocations in your tests using <a href="https://rubygems.org/gems/minitest-gcstats">minitest-gcstats</a>.</p>
<p>If any of those gems aren&rsquo;t exactly the setup you want it, you can always mix it up a bit and <a href="https://rubygems.org/gems/minitest-utils">roll your own gem</a> with reporters, helpers and improvements that are suitable for the way you write your tests.</p>
<p>Thanks to this extensibility, Rails 5 will bring some improvements to how you run the tests in your app to improve the overall testing experience with Rails (be sure to check <a href="https://github.com/rails/rails/pull/19216">this Pull Request</a> and the improvements from other Pull Requests).</p>
<blockquote>
<p>This post was originally published at
<a href="http://blog.plataformatec.com.br/2015/05/nobody-told-me-minitest-was-this-fun/">http://blog.plataformatec.com.br/2015/05/nobody-told-me-minitest-was-this-fun/</a></p>
</blockquote>

    </article>
  </div>

  <div class="py-8 flex lg:mx-auto lg:w-7/12 border-t border-slate-300 lg:justify-center gap-4 print:hidden">
  <p class="font-xs text-green-900">
    Copyright &copy; 2022 Lucas Mazza
  </p>
</div>


    
  <script defer src="/menu.08b9a569e417578ad09b03e0b4469fe181e7a74b3614ce1f7e2a7b98e7e99f29.js"></script>
  </body>
</html>